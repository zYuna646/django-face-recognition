# Set Python path for WSGI - harus di luar VirtualHost
WSGIPythonPath /app:/opt/venv/lib/python3.10/site-packages

<VirtualHost *:80>
    ServerName fer.webapps.digital
    ServerAdmin webmaster@localhost
    
    # Hapus DocumentRoot default agar tidak mengarah ke halaman default Apache
    # DocumentRoot /app

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # Increase log level for debugging
    LogLevel debug

    # WSGI configuration - lebih spesifik dan lengkap
    WSGIDaemonProcess django_app python-home=/opt/venv python-path=/app processes=2 threads=15 display-name=%{GROUP}
    WSGIProcessGroup django_app
    WSGIScriptAlias / /app/django_face_recog/wsgi.py
    
    # Izin untuk root direktori aplikasi
    <Directory /app>
        Require all granted
        Options FollowSymLinks
        AllowOverride None
    </Directory>

    # Izin khusus untuk file WSGI
    <Directory /app/django_face_recog>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>

    # Pastikan halaman default Apache tidak digunakan
    <Directory /var/www/html>
        Require all denied
    </Directory>

    # Static files configuration with improved access
    Alias /static/ /app/staticfiles/
    <Directory /app/staticfiles>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        Header set Cache-Control "max-age=86400"
        
        # Allow all files in static directory to be accessed
        <FilesMatch ".*">
            Require all granted
        </FilesMatch>
    </Directory>

    # Media files configuration
    Alias /media/ /app/media/
    <Directory /app/media>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        
        # Allow all files in media directory to be accessed
        <FilesMatch ".*">
            Require all granted
        </FilesMatch>
    </Directory>

    # Upload directory configuration
    Alias /upload/ /app/upload/
    <Directory /app/upload>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        
        # Allow all files in upload directory to be accessed
        <FilesMatch ".*">
            Require all granted
        </FilesMatch>
    </Directory>

    # Camera access headers - Modified for compatibility
    Header always set Cross-Origin-Opener-Policy "unsafe-none"
    Header always set Cross-Origin-Embedder-Policy "unsafe-none"
    
    # Allow camera access with more permissive CSP
    <IfModule mod_headers.c>
        Header set Content-Security-Policy "default-src * 'self' data: blob: 'unsafe-inline' 'unsafe-eval'"
    </IfModule>
</VirtualHost> 