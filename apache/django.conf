<VirtualHost *:80>
    ServerName fer.webapps.digital
    ServerAdmin webmaster@localhost
    DocumentRoot /app

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # WSGI configuration
    WSGIDaemonProcess django_app python-home=/opt/venv python-path=/app
    WSGIProcessGroup django_app
    WSGIScriptAlias / /app/django_face_recog/wsgi.py

    <Directory /app/django_face_recog>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>

    # Static files configuration with improved access
    Alias /static/ /app/staticfiles/
    <Directory /app/staticfiles>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        Header set Cache-Control "max-age=86400"
        
        # Allow all files in static directory to be accessed
        <FilesMatch ".*">
            Require all granted
        </FilesMatch>
    </Directory>

    # Media files configuration
    Alias /media/ /app/media/
    <Directory /app/media>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        
        # Allow all files in media directory to be accessed
        <FilesMatch ".*">
            Require all granted
        </FilesMatch>
    </Directory>

    # Upload directory configuration
    Alias /upload/ /app/upload/
    <Directory /app/upload>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        
        # Allow all files in upload directory to be accessed
        <FilesMatch ".*">
            Require all granted
        </FilesMatch>
    </Directory>

    # Camera access headers
    Header always set Cross-Origin-Opener-Policy "same-origin"
    Header always set Cross-Origin-Embedder-Policy "require-corp"
    
    # Allow camera access
    <IfModule mod_headers.c>
        Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self' data: blob:; connect-src 'self' blob:; worker-src 'self' blob:; frame-src 'self' blob:; form-action 'self';"
    </IfModule>
</VirtualHost> 